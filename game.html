<!DOCTYPE html>
<html>
<head>
    <title>3D Maze: Mobile Edition</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; touch-action: none; }
        #click-to-start { position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; cursor: pointer; color: white; text-align: center; }
        canvas { display: block; }
        
        /* MOBILE CONTROLS (Only visible on touch screens) */
        #mobile-controls { 
            position: absolute; bottom: 20px; left: 20px; 
            display: none; grid-template-columns: repeat(3, 60px); grid-template-rows: repeat(2, 60px); gap: 10px; z-index: 50; 
        }
        .btn { width: 60px; height: 60px; background: rgba(255,255,255,0.2); border: 2px solid #0f0; color: #0f0; display: flex; justify-content: center; align-items: center; border-radius: 10px; font-weight: bold; user-select: none; }
        
        @media (pointer: coarse) { #mobile-controls { display: grid; } }
    </style>
</head>
<body>
    <div id="click-to-start"><h1>üñ±Ô∏è CLICK TO START</h1><p>PC: WASD + Mouse | Mobile: Touch Buttons</p></div>
    
    <div id="mobile-controls">
        <div></div><div class="btn" id="m-up">W</div><div></div>
        <div class="btn" id="m-left">A</div><div class="btn" id="m-down">S</div><div class="btn" id="m-right">D</div>
    </div>

    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const startScreen = document.getElementById("click-to-start");
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const map = [[1,1,1,1,1,1],[1,0,0,0,0,1],[1,0,1,1,0,1],[1,0,0,2,0,1],[1,1,1,1,1,1]];
        const tileSize = 64;
        let player = { x: 96, y: 96, angle: 0 };
        let keys = {};
        let gameActive = false;

        // Pointer Lock (Desktop)
        startScreen.onclick = () => { if(!('ontouchstart' in window)) canvas.requestPointerLock(); else startScreen.style.display="none"; gameActive=true; };
        
        // Touch Controls (Mobile)
        const setupMobileBtn = (id, key) => {
            const el = document.getElementById(id);
            el.ontouchstart = (e) => { e.preventDefault(); keys[key] = true; };
            el.ontouchend = (e) => { e.preventDefault(); keys[key] = false; };
        };
        setupMobileBtn("m-up", "w"); setupMobileBtn("m-down", "s");
        setupMobileBtn("m-left", "a"); setupMobileBtn("m-right", "d");

        // Movement & Look Logic
        document.onmousemove = (e) => { if(gameActive) player.angle += e.movementX * 0.005; };
        window.onkeydown = (e) => keys[e.key.toLowerCase()] = true;
        window.onkeyup = (e) => keys[e.key.toLowerCase()] = false;

        function loop() {
            if(gameActive) {
                let nx = player.x, ny = player.y;
                if(keys['w']) { nx += Math.cos(player.angle)*3; ny += Math.sin(player.angle)*3; }
                if(keys['s']) { nx -= Math.cos(player.angle)*3; ny -= Math.sin(player.angle)*3; }
                if(keys['a']) { nx += Math.sin(player.angle)*3; ny -= Math.cos(player.angle)*3; }
                if(keys['d']) { nx -= Math.sin(player.angle)*3; ny += Math.cos(player.angle)*3; }
                if(map[Math.floor(ny/64)][Math.floor(nx/64)] === 0) { player.x = nx; player.y = ny; }
            }
            // Rendering code... (same as before)
            ctx.fillStyle = "#111"; ctx.fillRect(0,0,canvas.width,canvas.height/2);
            ctx.fillStyle = "#222"; ctx.fillRect(0,canvas.height/2,canvas.width,canvas.height/2);
            // Raycasting logic here...
            requestAnimationFrame(loop);
        }
        loop();
    </script>
</body>
</html>
